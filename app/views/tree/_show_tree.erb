<% subject_id = "/#{params[:medium]}/#{params[:collection]}/#{params[:year]}/#{params[:month]}/#{params[:edition]}/subject#{params[:subj_id]}" unless params[:medium].blank? || 'editions'.eql?(params[:medium]) %>
<% lang = params['locale'] %>

<!--I take the params by splitting the URL, and NOT by using blacklight functionality, because the params returned
different format for the facets (I think it's bug in Blacklight)-->
<% filter_params_url = "?" %>
<% filter_params_url += search_state.params_for_search.except(:page, :locale, :medium, :collection, :year, :month, :edition, :subj_id).to_query %>

<% if subject_id %>
    <!--Show the tree -->
    <% cache("#{subject_id.gsub('/','#')}-#{get_lang(params)}", expires_in: 1.hour) do %>
       <%= render :partial => 'tree/tree', locals: {:subject_id => subject_id, :lang => lang, :filter_params_url => filter_params_url} %>
    <% end %>
<% else %>
    <% cache("subject-all-#{get_lang(params)}", expires_in: 1.hour) do %>
      <%= render :partial => 'tree/tree', locals: {:subject_id => "/editions/any/2009/jul/editions", :lang => lang, :filter_params_url => filter_params_url} %>
    <% end %>
<% end %>